<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/default.css">
    <script src="js/vendor/jquery-2.1.4.min.js"></script>
    <script src="js/vendor/sockjs-0.3.4.min.js"></script>
    <script src="js/model/channel.js"></script>
    <script src="js/model/message.js"></script>
    <script src="js/model/user.js"></script>
    <script src="js/model/giveawayUser.js"></script>
    <script src="js/model/rankedQueueUser.js"></script>
    <script src="js/chats/sc2tv.js"></script>
    <script src="js/chats/funstream.js"></script>
    <script src="js/chats/gg.js"></script>
    <script src="js/chats/twitch.js"></script>
    <script src="js/chats/youtube.js"></script>
    <script src="js/rankController.js"></script>
    <script src="js/appLifeCycleService.js"></script>
    <script src="js/configSource.js"></script>
    <script src="js/chatSource.js"></script>
    <script src="js/vendor/handlebars.3.0.3.min.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/controllers/chatWindowViewController.js"></script>
    <script src="js/rankedQueueService.js"></script>
    <script src="js/controllers/rankQueueViewController.js"></script>
    <script src="js/giveawayService.js"></script>
    <script src="js/controllers/giveawayViewController.js"></script>
    <script src="js/commandController.js"></script>
    <script>
        $(function () {
            var gui = require('nw.gui');
            var win = gui.Window.get();
            win.on('new-win-policy', function(frame, url, policy){
                policy.ignore();
                gui.Shell.openExternal( url );
            });

            var appLifeCycleService = new AppLifeCycleService();
            var configSource = new ConfigSource("config.json", appLifeCycleService);
            var rankController = new RankController(configSource);
            var chatSource = new ChatSource(configSource, rankController);
            var rankedQueueService = new RankedQueueService("rankedQueue.json", appLifeCycleService, rankController);
            var giveawayService = new GiveawayService(rankController, chatSource);
            new CommandController(chatSource, rankController, rankedQueueService);
            new ChatWindowViewController($("#message_list"), chatSource, configSource);

            document.body.addEventListener('contextmenu', function(ev) {
                ev.preventDefault();
                var menu = new gui.Menu();
                var queueItem = new gui.MenuItem({ label: 'Очередь' });
                queueItem.click = function() {
                    new RankedQueueViewController(rankedQueueService);
                };
                menu.append(queueItem);
                var giveawayItem = new gui.MenuItem({ label: 'Розыгрыш' });
                giveawayItem.click = function() {
                    new GiveawayViewController(giveawayService);
                };
                menu.append(giveawayItem);
                menu.popup(ev.x, ev.y);
                return false;
            });
        });
    </script>
    <title>MasterChat</title>
</head>
<body>
<div id="chat_container">
    <div id="message_list" class="big-smiles animated-smiles">
    </div>
</div>
</body>
</html>